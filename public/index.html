<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaLearn</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>

<header class="header">
    <a href="index.html" class="logo">InstaLearn</a>

    <form action="/search-results.html" method="get">
        <input type="text" name="query" placeholder="Search in English" class="search-bar" required>
    </form>

    <div class="header-buttons">
        <a href="/create-new-set.html" class="btn">+ Create Set</a>
        <button class="logout">Log Out</button>
    </div>
</header>

<main class="main-content">
    <h1>Your Sets</h1>
    <div class="sets-container-wrapper">
        <div id="sets" class="sets-container">
        </div>
    </div>
</main>

<script>
    async function fetchUserSets(userId) {
        try {
            const response = await fetch(`http://localhost:8000/getUserSets?userId=${encodeURIComponent(userId)}`);
            if (!response.ok) throw new Error('Failed to fetch user sets');

            const sets = await response.json();

            sets.sort((a, b) => {
                const dateA = a.createdAt ? new Date(a.createdAt._seconds * 1000 + a.createdAt._nanoseconds / 1e6) : new Date(0);
                const dateB = b.createdAt ? new Date(b.createdAt._seconds * 1000 + b.createdAt._nanoseconds / 1e6) : new Date(0);
                return dateB - dateA; 
            });

            //console.log("Sorted sets by date:", sets);
            
            const setsContainer = document.getElementById('sets');
            console.log(setsContainer);
            sets.forEach(set => {
                const setElement = document.createElement('a');
                setElement.classList.add("set-card");
                var setName = set.id;
                setElement.href = "set.html?query=" + setName;
                setElement.textContent = setName.charAt(0).toUpperCase() + setName.slice(1);
                setsContainer.appendChild(setElement);
            });
         } catch (error) {
        console.error('Error fetching user sets:', error);
        }
    }
    // Example: Call this function with a userId
    fetchUserSets('userid1');
</script>

</body>
</html>